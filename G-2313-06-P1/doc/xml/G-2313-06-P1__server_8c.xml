<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.9.1">
  <compounddef id="G-2313-06-P1__server_8c" kind="file" language="C++">
    <compoundname>G-2313-06-P1_server.c</compoundname>
    <includes refid="G-2313-06-P1__server_8h" local="yes">../includes/G-2313-06-P1_server.h</includes>
    <incdepgraph>
      <node id="299">
        <label>sys/stat.h</label>
      </node>
      <node id="306">
        <label>stdbool.h</label>
      </node>
      <node id="312">
        <label>G-2313-06-P1_function_handlers.h</label>
        <link refid="G-2313-06-P1__function__handlers_8h"/>
        <childnode refid="296" relation="include">
        </childnode>
        <childnode refid="297" relation="include">
        </childnode>
        <childnode refid="298" relation="include">
        </childnode>
        <childnode refid="299" relation="include">
        </childnode>
        <childnode refid="300" relation="include">
        </childnode>
        <childnode refid="301" relation="include">
        </childnode>
        <childnode refid="302" relation="include">
        </childnode>
        <childnode refid="303" relation="include">
        </childnode>
        <childnode refid="304" relation="include">
        </childnode>
        <childnode refid="305" relation="include">
        </childnode>
        <childnode refid="306" relation="include">
        </childnode>
        <childnode refid="307" relation="include">
        </childnode>
        <childnode refid="308" relation="include">
        </childnode>
        <childnode refid="309" relation="include">
        </childnode>
        <childnode refid="310" relation="include">
        </childnode>
        <childnode refid="311" relation="include">
        </childnode>
        <childnode refid="313" relation="include">
        </childnode>
      </node>
      <node id="300">
        <label>netinet/in.h</label>
      </node>
      <node id="308">
        <label>arpa/inet.h</label>
      </node>
      <node id="313">
        <label>G-2313-06-P1_common_functions.h</label>
        <link refid="G-2313-06-P1__common__functions_8h"/>
        <childnode refid="296" relation="include">
        </childnode>
        <childnode refid="297" relation="include">
        </childnode>
        <childnode refid="298" relation="include">
        </childnode>
        <childnode refid="299" relation="include">
        </childnode>
        <childnode refid="300" relation="include">
        </childnode>
        <childnode refid="301" relation="include">
        </childnode>
        <childnode refid="302" relation="include">
        </childnode>
        <childnode refid="303" relation="include">
        </childnode>
        <childnode refid="304" relation="include">
        </childnode>
        <childnode refid="305" relation="include">
        </childnode>
        <childnode refid="306" relation="include">
        </childnode>
        <childnode refid="307" relation="include">
        </childnode>
        <childnode refid="308" relation="include">
        </childnode>
        <childnode refid="309" relation="include">
        </childnode>
        <childnode refid="310" relation="include">
        </childnode>
        <childnode refid="311" relation="include">
        </childnode>
      </node>
      <node id="302">
        <label>stdlib.h</label>
      </node>
      <node id="294">
        <label>errno.h</label>
      </node>
      <node id="293">
        <label>../includes/G-2313-06-P1_server.h</label>
        <link refid="G-2313-06-P1__server_8h"/>
        <childnode refid="294" relation="include">
        </childnode>
        <childnode refid="295" relation="include">
        </childnode>
        <childnode refid="296" relation="include">
        </childnode>
        <childnode refid="297" relation="include">
        </childnode>
        <childnode refid="298" relation="include">
        </childnode>
        <childnode refid="299" relation="include">
        </childnode>
        <childnode refid="300" relation="include">
        </childnode>
        <childnode refid="301" relation="include">
        </childnode>
        <childnode refid="302" relation="include">
        </childnode>
        <childnode refid="303" relation="include">
        </childnode>
        <childnode refid="304" relation="include">
        </childnode>
        <childnode refid="305" relation="include">
        </childnode>
        <childnode refid="306" relation="include">
        </childnode>
        <childnode refid="307" relation="include">
        </childnode>
        <childnode refid="308" relation="include">
        </childnode>
        <childnode refid="309" relation="include">
        </childnode>
        <childnode refid="310" relation="include">
        </childnode>
        <childnode refid="311" relation="include">
        </childnode>
        <childnode refid="312" relation="include">
        </childnode>
        <childnode refid="313" relation="include">
        </childnode>
        <childnode refid="314" relation="include">
        </childnode>
        <childnode refid="315" relation="include">
        </childnode>
      </node>
      <node id="314">
        <label>G-2313-06-P1_list.h</label>
        <link refid="G-2313-06-P1__list_8h"/>
      </node>
      <node id="310">
        <label>netdb.h</label>
      </node>
      <node id="315">
        <label>G-2313-06-P1_thread_pool.h</label>
        <link refid="G-2313-06-P1__thread__pool_8h"/>
        <childnode refid="311" relation="include">
        </childnode>
        <childnode refid="302" relation="include">
        </childnode>
        <childnode refid="303" relation="include">
        </childnode>
        <childnode refid="307" relation="include">
        </childnode>
        <childnode refid="301" relation="include">
        </childnode>
        <childnode refid="305" relation="include">
        </childnode>
        <childnode refid="296" relation="include">
        </childnode>
        <childnode refid="314" relation="include">
        </childnode>
      </node>
      <node id="301">
        <label>syslog.h</label>
      </node>
      <node id="311">
        <label>pthread.h</label>
      </node>
      <node id="297">
        <label>sys/types.h</label>
      </node>
      <node id="309">
        <label>redes2/irc.h</label>
      </node>
      <node id="296">
        <label>unistd.h</label>
      </node>
      <node id="305">
        <label>signal.h</label>
      </node>
      <node id="307">
        <label>time.h</label>
      </node>
      <node id="295">
        <label>sys/time.h</label>
      </node>
      <node id="304">
        <label>strings.h</label>
      </node>
      <node id="298">
        <label>sys/socket.h</label>
      </node>
      <node id="292">
        <label>src/G-2313-06-P1_server.c</label>
        <link refid="G-2313-06-P1_server.c"/>
        <childnode refid="293" relation="include">
        </childnode>
      </node>
      <node id="303">
        <label>stdio.h</label>
      </node>
    </incdepgraph>
      <sectiondef kind="var">
      <memberdef kind="variable" id="G-2313-06-P1__server_8c_1a30ca306f43cfccb8fd3efa98d77062d8" prot="public" static="yes" mutable="no">
        <type>bool</type>
        <definition>bool server_status</definition>
        <argsstring></argsstring>
        <name>server_status</name>
        <initializer>= true</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="48" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="48" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="G-2313-06-P1__server_8c_1a31fb5a902c59b78b39f2de4f26fd1fb1" prot="public" static="yes" mutable="no">
        <type>int</type>
        <definition>int server_socket_desc</definition>
        <argsstring></argsstring>
        <name>server_socket_desc</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="49" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="49" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="G-2313-06-P1__server_8c_1a57d8a6a060b67bdc5946cd0e7331575a" prot="public" static="no" mutable="no">
        <type><ref refid="structthread__pool__t" kindref="compound">thread_pool_t</ref> *</type>
        <definition>thread_pool_t* pool</definition>
        <argsstring></argsstring>
        <name>pool</name>
        <initializer>= NULL</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="51" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="51" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1aa8cae03a9b52c7a550cbbdcc8aa74ede" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int server_start</definition>
        <argsstring>()</argsstring>
        <name>server_start</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="101" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="101" bodyend="137"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1aaac8642d2e699e0f9d942d28a9b233c2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void server_accept_connection</definition>
        <argsstring>(int socket_desc)</argsstring>
        <name>server_accept_connection</name>
        <param>
          <type>int</type>
          <declname>socket_desc</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="171" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="171" bodyend="195"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1a81394df6131e7cf998bd06f63f9e3995" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void *</type>
        <definition>void* server_start_communication</definition>
        <argsstring>(int socket_desc)</argsstring>
        <name>server_start_communication</name>
        <param>
          <type>int</type>
          <declname>socket_desc</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="252" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="252" bodyend="316"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1a775161328c3264fb8f96981f7a9c83ae" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void server_execute_function</definition>
        <argsstring>(long functionName, char *command, int desc, char *nick, int *register_status)</argsstring>
        <name>server_execute_function</name>
        <param>
          <type>long</type>
          <declname>functionName</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>command</declname>
        </param>
        <param>
          <type>int</type>
          <declname>desc</declname>
        </param>
        <param>
          <type>char *</type>
          <declname>nick</declname>
        </param>
        <param>
          <type>int *</type>
          <declname>register_status</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="368" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="368" bodyend="402"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1a0e947005d451a8f3bf3af01f54b59f11" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void server_exit</definition>
        <argsstring>()</argsstring>
        <name>server_exit</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="436" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="436" bodyend="443"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1a64f1fffc5903ccf0350845cd21a95b6e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int server_check_socket_status</definition>
        <argsstring>(int socket_desc)</argsstring>
        <name>server_check_socket_status</name>
        <param>
          <type>int</type>
          <declname>socket_desc</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="473" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="473" bodyend="490"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1aa0e8000b12d9c52fc1e87847d00c9c47" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void server_daemon</definition>
        <argsstring>()</argsstring>
        <name>server_daemon</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="518" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="518" bodyend="527"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1a48d522cd984dc64ecd084f05416b1a94" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void server_start_pool</definition>
        <argsstring>()</argsstring>
        <name>server_start_pool</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="558" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="558" bodyend="563"/>
      </memberdef>
      <memberdef kind="function" id="G-2313-06-P1__server_8c_1ae66f6b31b5ad750f1fe042a706a4e3d4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int</type>
        <definition>int main</definition>
        <argsstring>()</argsstring>
        <name>main</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" line="565" column="1" bodyfile="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c" bodystart="565" bodyend="574"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&quot;../includes/G-2313-06-P1_server.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/>server_status<sp/>=<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>server_socket_desc;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51" refid="G-2313-06-P1__server_8c_1a57d8a6a060b67bdc5946cd0e7331575a" refkind="member"><highlight class="normal"><ref refid="structthread__pool__t" kindref="compound">thread_pool_t</ref><sp/>*<ref refid="G-2313-06-P1__server_8c_1a57d8a6a060b67bdc5946cd0e7331575a" kindref="member">pool</ref><sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="101" refid="G-2313-06-P1__server_8c_1aa8cae03a9b52c7a550cbbdcc8aa74ede" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1aa8cae03a9b52c7a550cbbdcc8aa74ede" kindref="member">server_start</ref>(){</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>socket_desc,<sp/>opt=TRUE;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">sockaddr_in<sp/>Direccion;</highlight></codeline>
<codeline lineno="104"><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog<sp/>(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;Creando<sp/>socket...&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<sp/>(socket_desc<sp/>=<sp/>socket(AF_INET,<sp/>SOCK_STREAM,<sp/>0))<sp/>&lt;<sp/>0<sp/>){</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>creando<sp/>socket&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(EXIT_FAILURE);</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Activar<sp/>multiconexion<sp/>del<sp/>socket<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(setsockopt(socket_desc,<sp/>SOL_SOCKET,<sp/>SO_REUSEADDR,<sp/>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*)&amp;opt,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(opt))<sp/>&lt;<sp/>0)</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perror(</highlight><highlight class="stringliteral">&quot;setsockopt&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(EXIT_FAILURE);</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>server_socket_desc<sp/>=<sp/>socket_desc;</highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/>Direccion.sin_family=AF_INET;<sp/></highlight><highlight class="comment">/*<sp/>TCP/IP<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/>Direccion.sin_port=htons(<ref refid="G-2313-06-P1__server_8h_1ac42367fe5c999ec6650de83e9d72fe8c" kindref="member">SERVER_PORT</ref>);<sp/></highlight><highlight class="comment">/*<sp/>Asignar<sp/>el<sp/>puerto<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/>Direccion.sin_addr.s_addr=htonl(INADDR_ANY);<sp/></highlight><highlight class="comment">/*<sp/>Aceptar<sp/>todas<sp/>las<sp/>IPs<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/>bzero((</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*)&amp;(Direccion.sin_zero),<sp/>8);</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;Socket<sp/>conectado<sp/>en<sp/>puerto<sp/>%d&quot;</highlight><highlight class="normal">,<sp/><ref refid="G-2313-06-P1__server_8h_1ac42367fe5c999ec6650de83e9d72fe8c" kindref="member">SERVER_PORT</ref>);</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(bind(socket_desc,<sp/>(</highlight><highlight class="keyword">struct</highlight><highlight class="normal"><sp/>sockaddr<sp/>*)&amp;Direccion,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(Direccion))<sp/>&lt;<sp/>0){</highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>conectando<sp/>socket&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>exit(EXIT_FAILURE);</highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="130"><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog<sp/>(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;Escuchando<sp/>conexiones...&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(listen(socket_desc,<sp/><ref refid="G-2313-06-P1__server_8h_1a053b7859476cc9867ec62c49e68d3fa1" kindref="member">MAX_CONNECTIONS</ref>)<sp/>&lt;<sp/>0){</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>escuchando<sp/>conexiones&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>exit(EXIT_FAILURE);</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>socket_desc;</highlight></codeline>
<codeline lineno="137"><highlight class="normal">}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="171" refid="G-2313-06-P1__server_8c_1aaac8642d2e699e0f9d942d28a9b233c2" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1aaac8642d2e699e0f9d942d28a9b233c2" kindref="member">server_accept_connection</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>socket_desc){</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>client_socket;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><ref refid="structtask__t" kindref="compound">task_t</ref><sp/>*t;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/>socklen_t<sp/>len;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">sockaddr<sp/>Conexion;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/>len<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(Conexion);</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(server_status){</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>client_socket<sp/>=<sp/>accept(socket_desc,<sp/>&amp;Conexion,<sp/>&amp;len);</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(client_socket<sp/>&lt;<sp/>0){</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;ERROR<sp/>aceptando<sp/>conexiones&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exit(EXIT_FAILURE);</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;--<sp/>Conexion<sp/>recibida<sp/>en<sp/>el<sp/>socket<sp/>(SD<sp/>padre:<sp/>%d,<sp/>SD<sp/>hijo:<sp/>%d)&quot;</highlight><highlight class="normal">,<sp/>socket_desc,<sp/>client_socket);</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*Se<sp/>lanza<sp/>el<sp/>servicio<sp/>y<sp/>se<sp/>espera<sp/>a<sp/>que<sp/>acabe,<sp/>de<sp/>momento<sp/>se<sp/>comenta*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>t<sp/>=<sp/><ref refid="G-2313-06-P1__thread__pool_8h_1afa05870619a7e753d41b8135b8514a2c" kindref="member">task_create</ref>();</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="G-2313-06-P1__thread__pool_8h_1a7241a5097164175e730f610eaad0aa5a" kindref="member">task_init</ref>(t,<sp/><ref refid="G-2313-06-P1__server_8c_1a81394df6131e7cf998bd06f63f9e3995" kindref="member">server_start_communication</ref>,<sp/>client_socket);</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="G-2313-06-P1__thread__pool_8h_1a113acb632971a3b3acd2cda2c4620bb3" kindref="member">task_add</ref>(pool,<sp/>t);</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;ACCEPT<sp/>CONNECTION:<sp/>LIMPIAR&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>free(t);</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="195"><highlight class="normal">}</highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight></codeline>
<codeline lineno="252" refid="G-2313-06-P1__server_8c_1a81394df6131e7cf998bd06f63f9e3995" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<ref refid="G-2313-06-P1__server_8c_1a81394df6131e7cf998bd06f63f9e3995" kindref="member">server_start_communication</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>socket_desc){</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>val_read,<sp/>*register_status<sp/>=<sp/>malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>str[2000],<sp/>*command=NULL,<sp/>*unpipeline_response=NULL,<sp/>*nick<sp/>=<sp/>malloc(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal">)<sp/>*<sp/>10);</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/>syslog<sp/>(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;Inicia<sp/>conexion<sp/>con...<sp/>%d&quot;</highlight><highlight class="normal">,<sp/>socket_desc);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/>*register_status<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(server_status)</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/>{</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="G-2313-06-P1__server_8c_1a64f1fffc5903ccf0350845cd21a95b6e" kindref="member">server_check_socket_status</ref>(socket_desc)){</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog<sp/>(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>Detectado<sp/>ausente,<sp/>desconectando...&quot;</highlight><highlight class="normal">,<sp/>socket_desc);</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(str,<sp/>0,<sp/>2000);</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>val_read<sp/>=<sp/>recv(socket_desc,<sp/>str,<sp/>2000,<sp/>0);</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">((val_read&lt;1)||(str[0]==</highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">)){</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog<sp/>(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>Detectado<sp/>ausente,<sp/>desconectando...&quot;</highlight><highlight class="normal">,<sp/>socket_desc);</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Comando<sp/>ya<sp/>parseado<sp/>-&gt;<sp/>Ejecuto<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/>unpipeline_response=IRC_UnPipelineCommands(str,<sp/>&amp;command);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;COMMAND:<sp/>%s<sp/>| PIPE:<sp/>%ld&quot;</highlight><highlight class="normal">,<sp/>command,<sp/>IRC_CommandQuery(command));</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="G-2313-06-P1__server_8c_1a775161328c3264fb8f96981f7a9c83ae" kindref="member">server_execute_function</ref>(IRC_CommandQuery(command),<sp/>command,<sp/>socket_desc,<sp/>nick,<sp/>register_status);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;PROCESADO&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(command){</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>free(command);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>command<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal">(unpipeline_response!=NULL){</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>unpipeline_response=IRC_UnPipelineCommands(unpipeline_response,<sp/>&amp;command);</highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;COMMAND:<sp/>%s<sp/>| PIPE:<sp/>%ld&quot;</highlight><highlight class="normal">,<sp/>command,<sp/>IRC_CommandQuery(command));</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="G-2313-06-P1__server_8c_1a775161328c3264fb8f96981f7a9c83ae" kindref="member">server_execute_function</ref>(IRC_CommandQuery(command),<sp/>command,<sp/>socket_desc,<sp/>nick,<sp/>register_status);</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(command){</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(command);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>command<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>Mensaje<sp/>enviado&quot;</highlight><highlight class="normal">,<sp/>socket_desc);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(*register_status&gt;0){</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>FIN<sp/>CLIENTE:<sp/>No<sp/>recibido<sp/>QUIT,<sp/>se<sp/>borran<sp/>datos<sp/>de:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>socket_desc,<sp/>nick);</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/>IRCTAD_Quit(nick);</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(<ref refid="G-2313-06-P1__common__functions_8h_1a61cca6f1a1adeb81f722ecc2ff35aab5" kindref="member">server_users_find_by_nick</ref>(nick)){</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>FIN<sp/>CLIENTE:<sp/>Sigue<sp/>existiendo<sp/>el<sp/>usuario:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>socket_desc,<sp/>nick);</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>FIN<sp/>CLIENTE:<sp/>Cliente<sp/>eliminado<sp/>correctamente:<sp/>%s&quot;</highlight><highlight class="normal">,<sp/>socket_desc,<sp/>nick);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;[DESC:<sp/>%d]<sp/>FIN<sp/>CLIENTE:<sp/>Cierra<sp/>desc&quot;</highlight><highlight class="normal">,<sp/>socket_desc);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Cerrar<sp/>conexion<sp/>con<sp/>el<sp/>usuario<sp/>y<sp/>liberar<sp/>el<sp/>hilo<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>close(socket_desc);</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(register_status){</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/>free(register_status);</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/>register_status<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(unpipeline_response){</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>free(unpipeline_response);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/>unpipeline_response<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(nick){</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>free(nick);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>nick<sp/>=<sp/>NULL;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;--&gt;<sp/>FIN<sp/>CLIENTE:<sp/>MUERE<sp/>EL<sp/>HILO&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/>pthread_exit(NULL);</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>NULL;</highlight></codeline>
<codeline lineno="316"><highlight class="normal">}</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="368" refid="G-2313-06-P1__server_8c_1a775161328c3264fb8f96981f7a9c83ae" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1a775161328c3264fb8f96981f7a9c83ae" kindref="member">server_execute_function</ref>(</highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>functionName,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>command,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>desc,<sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal">*<sp/>nick,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal">*<sp/>register_status){</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><ref refid="G-2313-06-P1__server_8h_1ae102cd0a63430b827183f70ce476a887" kindref="member">FunctionCallBack</ref><sp/>functions[IRC_MAX_USER_COMMANDS];</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*msg;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal">(i=0;<sp/>i&lt;IRC_MAX_USER_COMMANDS;<sp/>i++){</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/>functions[i]=NULL;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Definir<sp/>lista<sp/>de<sp/>funciones<sp/>para<sp/>cada<sp/>comando*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/>functions[NICK]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1aeefab469ba48ce1655dd5afd14f104b4" kindref="member">server_command_nick</ref>;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/>functions[USER]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1ad09156d6bd4cf58f4345e0bf851ff099" kindref="member">server_command_user</ref>;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/>functions[JOIN]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a375c143c5469d1bb4fa7793b310ad68e" kindref="member">server_command_join</ref>;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/>functions[QUIT]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a3df99a1f2cefc2d91d65cbb6dd555f96" kindref="member">server_command_quit</ref>;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/>functions[PING]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1acc1c181bf44087b9216d1b59809937aa" kindref="member">server_command_ping</ref>;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/>functions[LIST]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1af289e3cc397e24e9b8c12c35bce68285" kindref="member">server_command_list</ref>;</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/>functions[PRIVMSG]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a8daf68135f2d9e9412c04a2980bdfb2f" kindref="member">server_command_privmsg</ref>;</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/>functions[PART]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1aba1a3da1fb58bb35076e7ea56037463e" kindref="member">server_command_part</ref>;</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/>functions[NAMES]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a0fe05d80af27ae220f8fa631468606ea" kindref="member">server_command_names</ref>;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/>functions[KICK]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a33025bd9c7bf8fbb2bf9cf722c07465c" kindref="member">server_command_kick</ref>;</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/>functions[MODE]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a44a8736512c1df49d94c8194ae9b8a50" kindref="member">server_command_mode</ref>;</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/>functions[AWAY]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a327516a6c48e34b58428f7a502938928" kindref="member">server_command_away</ref>;</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/>functions[WHOIS]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a8bb934f01707fcb12ebac41f1fe69441" kindref="member">server_command_whois</ref>;</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/>functions[TOPIC]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a894ae019e03841e9d54fdad31d79f218" kindref="member">server_command_topic</ref>;</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/>functions[MOTD]<sp/>=<sp/>&amp;<ref refid="G-2313-06-P1__function__handlers_8h_1a1258d3bdf779b82c3f952bdde3d62631" kindref="member">server_command_motd</ref>;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Llamar<sp/>a<sp/>la<sp/>funcion<sp/>del<sp/>argumento<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((functionName&lt;0)||(functionName&gt;IRC_MAX_USER_COMMANDS)||(functions[functionName]==NULL)){</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(*register_status&gt;0){</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(IRCMsg_ErrUnKnownCommand(&amp;msg,<sp/></highlight><highlight class="stringliteral">&quot;ip.servidor&quot;</highlight><highlight class="normal">,<sp/>nick,<sp/>command)==IRC_OK){</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>send(desc,<sp/>msg,<sp/>strlen(msg),<sp/>0);</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>free(msg);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/>(*functions[functionName])(command,<sp/>desc,<sp/>nick,<sp/>register_status);</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="402"><highlight class="normal">}</highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="436" refid="G-2313-06-P1__server_8c_1a0e947005d451a8f3bf3af01f54b59f11" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1a0e947005d451a8f3bf3af01f54b59f11" kindref="member">server_exit</ref>(){</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/>server_status<sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/>close(server_socket_desc);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><ref refid="G-2313-06-P1__thread__pool_8h_1a46b14e66a9466a68fa4f67a2e08e81fd" kindref="member">thread_pool_delete</ref>(pool);</highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/>free(pool);</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;TODO<sp/>LIBERADO&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/>exit(EXIT_SUCCESS);</highlight></codeline>
<codeline lineno="443"><highlight class="normal">}</highlight></codeline>
<codeline lineno="444"><highlight class="normal"></highlight></codeline>
<codeline lineno="473" refid="G-2313-06-P1__server_8c_1a64f1fffc5903ccf0350845cd21a95b6e" refkind="member"><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1a64f1fffc5903ccf0350845cd21a95b6e" kindref="member">server_check_socket_status</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>socket_desc){</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>activity;</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/>fd_set<sp/>readfds;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">struct<sp/></highlight><highlight class="normal">timeval<sp/>timeout;</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/>FD_ZERO(&amp;readfds);</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/>FD_SET(socket_desc,<sp/>&amp;readfds);</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/>timeout.tv_sec<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/>timeout.tv_usec<sp/>=<sp/>10000;</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;COMPROBANDO<sp/>SOCKET<sp/>CON<sp/>SELECT...&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/>activity<sp/>=<sp/>select(socket_desc,<sp/>&amp;readfds,<sp/>NULL,<sp/>NULL,<sp/>&amp;timeout);</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((activity<sp/>&lt;<sp/>0)<sp/>&amp;&amp;<sp/>(errno!=EINTR)){</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;Socket<sp/>cerrado&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/>syslog(LOG_INFO,<sp/></highlight><highlight class="stringliteral">&quot;Socket<sp/>abierto&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="490"><highlight class="normal">}</highlight></codeline>
<codeline lineno="491"><highlight class="normal"></highlight></codeline>
<codeline lineno="518" refid="G-2313-06-P1__server_8c_1aa0e8000b12d9c52fc1e87847d00c9c47" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1aa0e8000b12d9c52fc1e87847d00c9c47" kindref="member">server_daemon</ref>(){</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>pid;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/>pid<sp/>=<sp/>fork();</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(pid&lt;0){</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(EXIT_FAILURE);</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal">(pid&gt;0){</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/>exit(EXIT_SUCCESS);</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="527"><highlight class="normal">}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"></highlight></codeline>
<codeline lineno="558" refid="G-2313-06-P1__server_8c_1a48d522cd984dc64ecd084f05416b1a94" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1a48d522cd984dc64ecd084f05416b1a94" kindref="member">server_start_pool</ref>(){</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*<sp/>Inicializar<sp/>thread<sp/>pool<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/>pool<sp/>=<sp/><ref refid="G-2313-06-P1__thread__pool_8h_1ae4c7364510f378011559c4eb6078e3ea" kindref="member">thread_pool_create</ref>(<ref refid="G-2313-06-P1__server_8h_1a80c7be19e867e55f90be3fa66cf65300" kindref="member">MIN_POOL_THREADS</ref>);</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/>syslog(LOG_ERR,<sp/></highlight><highlight class="stringliteral">&quot;POOL<sp/>INICIADA:<sp/>(%d<sp/>hilos<sp/>base)&quot;</highlight><highlight class="normal">,<sp/><ref refid="G-2313-06-P1__server_8h_1a80c7be19e867e55f90be3fa66cf65300" kindref="member">MIN_POOL_THREADS</ref>);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><ref refid="G-2313-06-P1__thread__pool_8h_1aa9d4a7977fc5b5b534b60415a3aa7311" kindref="member">thread_pool_init</ref>(pool);</highlight></codeline>
<codeline lineno="563"><highlight class="normal">}</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565" refid="G-2313-06-P1__server_8c_1ae66f6b31b5ad750f1fe042a706a4e3d4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="G-2313-06-P1__server_8c_1ae66f6b31b5ad750f1fe042a706a4e3d4" kindref="member">main</ref>(){</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*struct<sp/>sigaction<sp/>act;</highlight></codeline>
<codeline lineno="567"><highlight class="comment"><sp/><sp/>act.sa_handler<sp/>=<sp/>server_exit;</highlight></codeline>
<codeline lineno="568"><highlight class="comment"><sp/><sp/>sigaction(SIGKILL,<sp/>&amp;act,<sp/>NULL);*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">/*server_daemon();*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/>signal(SIGINT,<sp/><ref refid="G-2313-06-P1__server_8c_1a0e947005d451a8f3bf3af01f54b59f11" kindref="member">server_exit</ref>);</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><ref refid="G-2313-06-P1__server_8c_1a48d522cd984dc64ecd084f05416b1a94" kindref="member">server_start_pool</ref>();</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><ref refid="G-2313-06-P1__server_8c_1aaac8642d2e699e0f9d942d28a9b233c2" kindref="member">server_accept_connection</ref>(<ref refid="G-2313-06-P1__server_8c_1aa8cae03a9b52c7a550cbbdcc8aa74ede" kindref="member">server_start</ref>());</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="574"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="/media/psf/Tercer curso/Segundo semestre/REDES2/IRCServer/G-2313-06-P1/src/G-2313-06-P1_server.c"/>
  </compounddef>
</doxygen>
